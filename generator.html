<style>
    /* åŸºç¤å…¨å±€æ¨£å¼ */
    .wrapper {
        max-width: 730px;
        margin: 0 auto;
    }

    img {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: relative;
    }

    .blank-space {
        height: 60vh;
    }

    /* è¦–å·®ç›¸é—œæ¨£å¼ */
    .parallax__img-wrapper {
        aspect-ratio: 4 / 5;
        position: relative;
        overflow: hidden;
        perspective: 800px;
    }

    .parallax__img--full {
        width: 100vw;
        margin: 1rem 0rem;
        margin-left: calc((100vw - 730px)/ 2 * -1);
    }

    .parallax__img--absolute {
        position: absolute;
        top: 0;
    }

    /* ä¿ç•™èˆŠé¡åå…¼å®¹ */
    .parallax_img-wrapper {
        aspect-ratio: 4 / 5;
        position: relative;
        overflow: hidden;
        perspective: 800px;
    }

    .is-abs {
        position: absolute;
        top: 0;
    }

    /* é¢æ¿å…±ç”¨æ¨£å¼ */
    .panel {
        position: fixed;
        left: 20px;
        top: 20px;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        padding: 15px;
        border-radius: 5px;
        z-index: 10000;
        width: 300px;
        font-family: 'Arial', sans-serif;
        color: white;
        height: auto;
        max-height: calc(100vh - 80px);
        overflow-y: auto;
        overflow-x: hidden;
        transition: transform 0.3s ease-in-out;
        /* éš±è—scrollbarä½†ä¿æŒå¯æ»¾å‹• */
        scrollbar-width: none;
        /* Firefox */
        -ms-overflow-style: none;
        /* IE and Edge */
    }

    /* éš±è—Chromeå’ŒSafariçš„scrollbar */
    .panel::-webkit-scrollbar {
        display: none;
    }

    .panel.hidden {
        transform: translateX(-350px);
    }

    .panel__title {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 18px;
        text-align: center;
    }

    .panel__hint {
        text-align: left;
        margin-top: 10px;
        font-size: 14px;
    }

    .panel__item {
        margin-bottom: 15px;
    }

    .panel__label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 16px;
    }

    .panel__value {
        font-weight: bold;
    }

    .panel__slider {
        width: 100%;
        margin-top: 5px;
    }

    .panel__progress {
        margin-bottom: 16px;
        border-radius: 3px;
    }

    .panel__progress-label {
        font-size: 16px;
    }

    /* åœ–ç‰‡ç®¡ç†é¢æ¿ç‰¹å®šæ¨£å¼ */
    .panel--image-manager {
        top: 20px;
        max-height: 80vh;
        overflow-y: auto;
    }

    /* æŒ‰éˆ•é€šç”¨æ¨£å¼ */
    .btn {
        border: none;
        border-radius: 3px;
        cursor: pointer;
        padding: 8px 12px;
        font-size: 14px;
    }

    .btn--primary {
        background-color: #4CAF50;
        color: white;
    }

    .btn--danger {
        background-color: #f44336;
        color: white;
    }

    .btn--secondary {
        background-color: #555;
        color: white;
    }

    .btn--full {
        width: 100%;
    }

    /* æŒ‰éˆ•å®¹å™¨ */
    .btn-group {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }

    /* åœ–ç‰‡åˆ—è¡¨æ¨£å¼ */
    .image-list {
        margin-top: 15px;
    }

    .image-item {
        background-color: rgba(255, 255, 255, 0.1);
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 3px;
        position: relative;
    }

    .image-item__header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .image-item__name {
        flex: 1;
        margin-right: 10px;
        font-weight: bold;
    }

    .image-item__controls {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .image-item__z-index {
        display: flex;
        align-items: center;
        gap: 5px;
        margin-right: 10px;
        background: rgba(255, 255, 255, 0.1);
        padding: 2px 5px;
        border-radius: 3px;
    }

    .image-item__z-index-value {
        color: white;
        min-width: 20px;
        text-align: center;
    }

    .image-item__url {
        width: 100%;
        margin-bottom: 8px;
        padding: 5px;
    }

    /* æ‰‹é¢¨ç´é¢æ¿æ¨£å¼ */
    .accordion__header {
        background-color: rgba(255, 255, 255, 0.1);
        padding: 8px;
        margin-top: 5px;
        cursor: pointer;
        border-radius: 3px;
        user-select: none;
    }

    .accordion__content {
        padding: 8px;
        display: none;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 0 0 3px 3px;
    }

    .code-editor {
        width: 100%;
        height: 100px;
        background-color: #1e1e1e;
        color: #d4d4d4;
        font-family: monospace;
        padding: 8px;
        margin-bottom: 8px;
        border: 1px solid #333;
        border-radius: 3px;
    }

    /* ç®­é ­æŒ‰éˆ•æ¨£å¼ */
    .toggle-button {
        position: fixed;
        left: 310px;
        top: 30px;
        width: 30px;
        height: 30px;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 99999;
        font-size: 16px;
        font-family: Arial, sans-serif;
    }

    .toggle-button.hidden {
        left: 10px;
        transform: rotate(180deg);
    }

    /* å°å‡ºå°è©±æ¡†æ¨£å¼ */
    .export-dialog {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        border-radius: 5px;
        z-index: 10001;
        max-width: 80%;
        width: 500px;
    }

    .export-dialog h3 {
        margin-top: 0;
        background: #eee;
        padding: 16px;
        border-radius: 8px;
        color: #111;
    }

    .export-dialog hr {
        border: 1px solid #444;
        margin: 15px 0;
    }

    .export-dialog h4 {
        margin-top: 0;
    }

    .export-dialog code {
        color: #ddd;
    }

    .export-dialog__code-block {
        background: #333;
        padding: 8px;
        border-radius: 4px;
        margin: 10px 0;
    }

    .export-dialog__tip {
        background-color: #444;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
    }

    .export-dialog__button-group {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 15px 0;
    }

    .export-dialog__template-button,
    .export-dialog__close-button,
    .export-dialog__download-button {
        display: inline-block;
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 4px;
        font-weight: bold;
        border: none;
        cursor: pointer;
        font-size: 14px;
    }

    .export-dialog__close-button {
        background-color: #555;
    }

    .export-dialog__download-button {
        background-color: #2196F3;
    }

    /* Switch æŒ‰éˆ•æ¨£å¼ */
    .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
        margin: 5px 0;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .switch-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #555;
        border-radius: 24px;
        transition: 0.3s;
    }

    .switch-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        border-radius: 50%;
        transition: 0.3s;
    }

    input:checked+.switch-slider {
        background-color: #4CAF50;
    }

    input:checked+.switch-slider:before {
        transform: translateX(26px);
    }

    .switch-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
    }

    .btn--small {
        padding: 2px 6px;
        font-size: 12px;
        min-width: 20px;
    }
</style>

<div class="wrapper">
    <div class="blank-space"></div>
    <div class="parallax_wrapper" id="parallax-1">
        <div class="parallax_img-wrapper parallax__img-wrapper">
            <img class="is-bg"
                src="https://www.twreporter.org/images/20250409184447-4ec8004f3e32d67fe5bf5028777d575c-desktop.png"
                alt="" />
            <!-- å‹•æ…‹ç”Ÿæˆçš„åœ–ç‰‡å°‡è¢«æ’å…¥é€™è£¡ -->
        </div>
    </div>
    <div class="blank-space"></div>
    <div class="blank-space"></div>
</div>

<!-- æ§åˆ¶é¢æ¿ -->
<button id="toggle-panel" class="toggle-button">â†</button>
<div id="control-panel" class="panel">
    <div id="scroll-progress" class="panel__progress">
        <div class="panel__progress-label">æ»¾å‹•é€²åº¦: <span id="progress-value" class="panel__value">0%</span></div>
    </div>
    <div class="panel__item">
        <label class="panel__label">
            scroller-start
            <span id="start-value" class="panel__value">25%</span>
        </label>
        <input type="range" id="start-slider" class="panel__slider" min="0" max="100" value="25" step="1">
    </div>
    <div class="panel__item">
        <label class="panel__label">
            trigger-start
            <span id="trigger-start-value" class="panel__value">0%</span>
        </label>
        <input type="range" id="trigger-start-slider" class="panel__slider" min="0" max="100" value="0" step="1">
    </div>
    <div class="panel__item">
        <label class="panel__label">
            æ»¾å‹•è·é›¢é¡å‹
            <select id="scroll-distance-type" class="panel__select">
                <option value="pixel">å›ºå®šåƒç´ </option>
                <option value="viewHeight">è¦–çª—é«˜åº¦ç™¾åˆ†æ¯”</option>
                <option value="custom">è‡ªå®šç¾©å‡½æ•¸</option>
            </select>
        </label>
    </div>

    <div class="panel__item" id="pixel-distance-container">
        <label class="panel__label">
            æ»¾å‹•è·é›¢ (åƒç´ )
            <span id="scroll-distance-value" class="panel__value">500</span>
        </label>
        <input type="range" id="scroll-distance-slider" class="panel__slider" min="100" max="2000" value="500"
            step="50">
    </div>

    <div class="panel__item" id="viewheight-distance-container" style="display:none;">
        <label class="panel__label">
            æ»¾å‹•è·é›¢ (è¦–çª—é«˜åº¦%)
            <span id="scroll-viewheight-value" class="panel__value">50</span>
        </label>
        <input type="range" id="scroll-viewheight-slider" class="panel__slider" min="10" max="200" value="50" step="5">
    </div>

    <div class="panel__item" id="custom-distance-container" style="display:none;">
        <label class="panel__label">
            è‡ªå®šç¾©æ»¾å‹•å‡½æ•¸
        </label>
        <textarea id="scroll-custom-code" class="code-editor">() => "+=" + (window.innerHeight * 0.5)</textarea>
        <div class="panel__hint">å‡½æ•¸å¿…é ˆè¿”å›æœ‰æ•ˆçš„ScrollTrigger endå€¼</div>
    </div>
    <div class="panel__item">
        <label class="switch-label">
            é¡¯ç¤ºæ¨™è¨˜
            <label class="switch">
                <input type="checkbox" id="markers-toggle" checked>
                <span class="switch-slider"></span>
            </label>
        </label>
    </div>
    <div class="panel__item">
        <button id="reset-settings" class="btn btn--danger btn--full">é‡ç½®æ»¾å‹•è¨­å®š</button>
    </div>
    <hr style="border: 1px solid rgba(255, 255, 255, 0.2); margin: 15px 0;">
    <div class="btn-group">
        <button id="add-image" class="btn btn--primary btn--full">æ–°å¢åœ–ç‰‡</button>
        <button id="reset-images" class="btn btn--danger btn--full">é‡ç½®åœ–ç‰‡</button>
        <button id="export-config" class="btn btn--secondary btn--full">è¤‡è£½json</button>
    </div>
    <div class="panel__hint" style="margin-bottom: 10px;">
        1. è¤‡è£½å¾å·¥å…·å°å‡ºçš„JSONé…ç½®<br>
        2. ä¸‹è¼‰æ¨¡æ¿æ–‡ä»¶ï¼Œä¸¦åœ¨æ¨™è¨˜å€åŸŸä¸­æ›¿æ›é…ç½®æ•¸æ“š<br>
        3. å°‡ä¿®æ”¹å¾Œçš„æ¨¡æ¿ä»£ç¢¼åµŒå…¥åˆ°æ‚¨çš„CMSä¸­
    </div>
    <div id="image-list" class="image-list">
        <!-- å‹•æ…‹ç”Ÿæˆçš„åœ–ç‰‡é …ç›®å°‡è¢«æ’å…¥é€™è£¡ -->
    </div>
</div>

<!-- å°å‡ºå°è©±æ¡†æ¨¡æ¿ -->
<div id="export-dialog" class="export-dialog" style="display: none;">
    <h3>å·²è¤‡è£½JSONåˆ°å‰ªè²¼ç°¿</h3>
    <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¸‹è¼‰é…ç½®æ–‡ä»¶</p>
    <hr>
    <h4>å¦‚ä½•ä½¿ç”¨é…ç½®</h4>
    <p>1. ä¸‹è¼‰æ¨¡æ¿æ–‡ä»¶ <a href="parallax_template.html" style="color: #4CAF50;" download>parallax_template.html</a></p>
    <p>2. ç”¨æ–‡æœ¬ç·¨è¼¯å™¨æ‰“é–‹æ¨¡æ¿æ–‡ä»¶ï¼Œæ‰¾åˆ°ä»¥ä¸‹æ¨™è¨˜å€åŸŸï¼š</p>
    <div class="export-dialog__code-block">
        <code>// === é–‹å§‹ï¼šé…ç½®æ•¸æ“šï¼ˆè«‹å‹¿ä¿®æ”¹æ­¤è¡Œï¼‰ ===<br>const config = { ... };<br>// === çµæŸï¼šé…ç½®æ•¸æ“šï¼ˆè«‹å‹¿ä¿®æ”¹æ­¤è¡Œï¼‰ ===</code>
    </div>
    <p>3. å°‡å‰ªè²¼ç°¿ä¸­çš„JSONæ›¿æ›æ•´å€‹configå°è±¡</p>
    <p>4. å°‡ä¿®æ”¹å¾Œçš„æ¨¡æ¿ä»£ç¢¼åµŒå…¥åˆ°æ‚¨çš„CMSä¸­</p>
    <p class="export-dialog__tip"><strong>ğŸ“Œæ–°åŠŸèƒ½</strong>: æ¯å€‹è¦–å·®æ¨¡çµ„ç¾åœ¨åŒ…å«å”¯ä¸€IDï¼Œå¯ä»¥åœ¨åŒä¸€é é¢åµŒå…¥å¤šå€‹æ¨¡çµ„äº’ä¸å¹²æ“¾!</p>
    <div class="export-dialog__button-group">
        <button class="export-dialog__download-button">ä¸‹è¼‰json</button>
        <button class="export-dialog__close-button">é—œé–‰</button>
    </div>
</div>

<script type="module">
    import { gsap } from 'https://cdn.jsdelivr.net/npm/gsap@3.12.7/+esm';
    import { ScrollTrigger } from 'https://cdn.jsdelivr.net/npm/gsap@3.12.7/ScrollTrigger.js/+esm';

    gsap.registerPlugin(ScrollTrigger);

    // è½‰æ›URLç‚ºå„ç¨®å°ºå¯¸ç‰ˆæœ¬çš„å‡½æ•¸
    function generateSrcSet(url) {
        // æª¢æŸ¥URLæ˜¯å¦ç‚ºç©ºæˆ–ç„¡æ•ˆ
        if (!url || typeof url !== 'string') {
            return { src: url, srcset: '' };
        }

        // æª¢æŸ¥URLæ˜¯å¦å·²ç¶“åŒ…å«å°ºå¯¸å¾Œç¶´
        const sizePatterns = ['-tiny', '-w400', '-tablet', '-mobile', '-desktop'];
        let baseUrl = '';
        let detectedPattern = '';
        let fileExtension = '.jpg'; // é»˜èªæ“´å±•å

        // ç²å–æ–‡ä»¶æ“´å±•å
        if (url.toLowerCase().endsWith('.png')) {
            fileExtension = '.png';
        } else if (url.toLowerCase().endsWith('.jpg') || url.toLowerCase().endsWith('.jpeg')) {
            fileExtension = '.jpg';
        }

        // æŸ¥æ‰¾URLä¸­åŒ…å«çš„å°ºå¯¸å¾Œç¶´
        for (const pattern of sizePatterns) {
            if (url.includes(pattern)) {
                // å¾URLä¸­æå–åŸºæœ¬è·¯å¾‘ï¼ˆä¸åŒ…å«å°ºå¯¸å¾Œç¶´å’Œæ–‡ä»¶æ“´å±•åï¼‰
                baseUrl = url.substring(0, url.lastIndexOf(pattern));
                detectedPattern = pattern;
                break;
            }
        }

        // å¦‚æœæ²’æœ‰æ‰¾åˆ°å°ºå¯¸å¾Œç¶´ï¼Œè¿”å›åŸå§‹URL
        if (!detectedPattern) {
            return { src: url, srcset: '' };
        }

        // ç”Ÿæˆä¸åŒå¤§å°çš„URLå’Œå¯¬åº¦çµ„åˆ
        const srcset = [
            `${baseUrl}-mobile${fileExtension} 800w`,
            `${baseUrl}-tablet${fileExtension} 1200w`,
            `${baseUrl}-desktop${fileExtension} 2000w`,
            `${baseUrl}-tiny${fileExtension} 150w`
        ].join(', ');

        // é»˜èªé¡¯ç¤ºçš„åœ–ç‰‡ï¼Œæ ¹æ“šè¨­å‚™é¡å‹é¸æ“‡
        const defaultSrc = `${baseUrl}-mobile${fileExtension}`;

        return { src: defaultSrc, srcset };
    }

    // æœ¬åœ°å„²å­˜çš„éµå
    const STORAGE_KEY = 'gsap_scroll_config';
    const IMAGES_STORAGE_KEY = 'gsap_images_config';

    // ç²å–DOMå…ƒç´ 
    const controlPanel = document.getElementById('control-panel');
    const toggleButton = document.getElementById('toggle-panel');
    const startSlider = document.getElementById('start-slider');
    const startValue = document.getElementById('start-value');
    const triggerStartSlider = document.getElementById('trigger-start-slider');
    const triggerStartValue = document.getElementById('trigger-start-value');
    const scrollDistanceSlider = document.getElementById('scroll-distance-slider');
    const scrollDistanceValue = document.getElementById('scroll-distance-value');
    const progressValue = document.getElementById('progress-value');
    const resetButton = document.getElementById('reset-settings');
    const addImageButton = document.getElementById('add-image');
    const resetImagesButton = document.getElementById('reset-images');
    const exportConfigButton = document.getElementById('export-config');
    const imageList = document.getElementById('image-list');

    // æ§åˆ¶é¢æ¿å’ŒmarkersåŠåœ–ç‰‡ç®¡ç†å™¨çš„é¡¯ç¤ºç‹€æ…‹
    const MARKERS_STORAGE_KEY = 'gsap_markers_visible';
    const IMAGE_MANAGER_STORAGE_KEY = 'gsap_image_manager_visible';

    // å¾localStorageç²å–ä¿å­˜çš„é¡¯ç¤ºç‹€æ…‹ï¼Œé è¨­ç‚ºtrueï¼ˆé¡¯ç¤ºï¼‰
    let SHOW_MARKERS = localStorage.getItem(MARKERS_STORAGE_KEY) === 'true' || true;
    let controlPanelVisible = true; // å§‹çµ‚é¡¯ç¤ºæ§åˆ¶é¢æ¿
    let imageManagerVisible = true; // å§‹çµ‚é¡¯ç¤ºåœ–ç‰‡ç®¡ç†å™¨

    // é—œéµè©è¼¸å…¥
    let keyBuffer = '';
    let lastKeyTime = 0;
    const KEY_TIMEOUT = 3000; // 3ç§’è¶…æ™‚
    const HIDE_SCROLL_KEYWORD = 'hidescroll';
    const HIDE_IMAGE_KEYWORD = 'hideimage';

    // æ§åˆ¶scrolltriggerçš„é…ç½®
    const SCROLL_CONFIG = loadScrollConfig();

    // å­˜å„²åœ–ç‰‡é…ç½®çš„æ•¸çµ„
    let IMAGES_CONFIG = loadImagesConfig();
    let imageIdCounter = getNextImageId();

    // å¾æœ¬åœ°å„²å­˜åŠ è¼‰è¨­å®šï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨é»˜èªå€¼
    function loadScrollConfig() {
        try {
            const savedConfig = localStorage.getItem(STORAGE_KEY);
            return savedConfig ? JSON.parse(savedConfig) : getDefaultConfig();
        } catch (error) {
            console.error('Error loading saved config:', error);
            return getDefaultConfig();
        }
    }

    // å¾æœ¬åœ°å„²å­˜åŠ è¼‰åœ–ç‰‡é…ç½®
    function loadImagesConfig() {
        try {
            const savedConfig = localStorage.getItem(IMAGES_STORAGE_KEY);
            return savedConfig ? JSON.parse(savedConfig) : getDefaultImagesConfig();
        } catch (error) {
            console.error('Error loading saved images config:', error);
            return getDefaultImagesConfig();
        }
    }

    // ç²å–ä¸‹ä¸€å€‹å¯ç”¨çš„åœ–ç‰‡ID
    function getNextImageId() {
        if (IMAGES_CONFIG.length === 0) return 1;
        // æ‰¾å‡ºæœ€å¤§IDä¸¦åŠ 1
        return Math.max(...IMAGES_CONFIG.map(img => img.id)) + 1;
    }

    // ç²å–é»˜èªé…ç½®
    function getDefaultConfig() {
        return {
            startViewportPosition: 0.25, // è¦–çª—é ‚éƒ¨ 25% çš„ä½ç½®
            triggerStartPosition: 0,     // è§¸ç™¼å™¨ä¸Šç·£ 0% çš„ä½ç½®
            scrollDistance: 500,         // æ»¾å‹•è·é›¢ï¼Œå–®ä½ç‚ºåƒç´ 
            scrollDistanceType: 'pixel', // æ–°å¢ï¼šè·é›¢é¡å‹ (pixel, viewHeight, custom)
            scrollViewHeightValue: 50,   // æ–°å¢ï¼šè¦–çª—é«˜åº¦ç™¾åˆ†æ¯”å€¼
            scrollDistanceCustom: '() => "+=" + (window.innerHeight * 0.5)' // æ–°å¢ï¼šè‡ªå®šç¾©å‡½æ•¸
        };
    }

    // ç²å–é»˜èªåœ–ç‰‡é…ç½®
    function getDefaultImagesConfig() {
        return [
            {
                id: 0,  // ä½¿ç”¨ID 0è¡¨ç¤ºèƒŒæ™¯åœ–
                name: "èƒŒæ™¯åœ–",
                url: "https://www.twreporter.org/images/20250409184447-4ec8004f3e32d67fe5bf5028777d575c-desktop.png",
                isBackground: true,  // æ¨™è¨˜ç‚ºèƒŒæ™¯åœ–
                zIndex: 1
            },
            {
                id: 1,
                name: "ç…™éœ§",
                url: "https://www.twreporter.org/images/20250409184056-1a0014ac9d41865fca76ccc420c1383e-desktop.png",
                fromParams: `{
  scale: 1.25,
  transformOrigin: "50% bottom"
}`,
                toParams: `{
  scale: 1,
  transformOrigin: "50% bottom"
}`,
                zIndex: 2
            },
            {
                id: 2,
                name: "æ‰‹éƒ¨",
                url: "https://www.twreporter.org/images/20250409184322-70971186e62ef80444851b62fe85a75f-desktop.png",
                fromParams: `{
  x: "5%",
  transformOrigin: "75% 50%"
}`,
                toParams: `{
  x: 0,
  transformOrigin: "70% 50%"
}`,
                zIndex: 3
            },
            {
                id: 3,
                name: "æ–‡å­—",
                url: "https://www.twreporter.org/images/20250409184351-57c9c8821c301f1b6af70ae8ae020c2a-desktop.png",
                fromParams: `{
  scale: 0.5,
  opacity: 0,
  transformOrigin: "10% 25%"
}`,
                toParams: `{
  scale: 1,
  opacity: 1
}`,
                zIndex: 4
            },
            {
                id: 4,
                name: "å¤–æ¡†",
                url: "https://www.twreporter.org/images/20250409184416-190075b6600cb5bf9bbd8372ea9dd805-desktop.png",
                fromParams: `{}`,
                toParams: `{}`,
                zIndex: 5
            }
        ];
    }

    // å„²å­˜è¨­å®šåˆ°æœ¬åœ°å„²å­˜
    function saveScrollConfig() {
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(SCROLL_CONFIG));
            console.log('Settings saved:', SCROLL_CONFIG);
        } catch (error) {
            console.error('Error saving config:', error);
        }
    }

    // å„²å­˜åœ–ç‰‡é…ç½®åˆ°æœ¬åœ°å„²å­˜
    function saveImagesConfig() {
        try {
            localStorage.setItem(IMAGES_STORAGE_KEY, JSON.stringify(IMAGES_CONFIG));
            console.log('Images config saved:', IMAGES_CONFIG);
        } catch (error) {
            console.error('Error saving images config:', error);
        }
    }

    // åˆå§‹åŒ–æ»‘å¡Šå€¼
    function initializeSliders() {
        startSlider.value = SCROLL_CONFIG.startViewportPosition * 100;
        triggerStartSlider.value = SCROLL_CONFIG.triggerStartPosition * 100;
        scrollDistanceSlider.value = SCROLL_CONFIG.scrollDistance;

        // åˆå§‹åŒ–æ»¾å‹•è·é›¢é¡å‹æ§åˆ¶é …
        const distanceTypeSelect = document.getElementById('scroll-distance-type');
        const viewHeightSlider = document.getElementById('scroll-viewheight-slider');
        const viewHeightValue = document.getElementById('scroll-viewheight-value');
        const customCodeInput = document.getElementById('scroll-custom-code');

        if (distanceTypeSelect) {
            distanceTypeSelect.value = SCROLL_CONFIG.scrollDistanceType;
            viewHeightSlider.value = SCROLL_CONFIG.scrollViewHeightValue;
            viewHeightValue.textContent = SCROLL_CONFIG.scrollViewHeightValue;
            customCodeInput.value = SCROLL_CONFIG.scrollDistanceCustom;

            // æ›´æ–°UIé¡¯ç¤º
            updateDistanceTypeUI(SCROLL_CONFIG.scrollDistanceType);
        }

        updateSliderLabels();
    }

    // æ›´æ–°æ»‘å¡Šæ¨™ç±¤
    function updateSliderLabels() {
        startValue.textContent = `${Math.round(SCROLL_CONFIG.startViewportPosition * 100)}%`;
        triggerStartValue.textContent = `${Math.round(SCROLL_CONFIG.triggerStartPosition * 100)}%`;
        scrollDistanceValue.textContent = `${SCROLL_CONFIG.scrollDistance}`;
    }

    // é¡¯ç¤º/éš±è—ä¸åŒé¡å‹çš„æ§åˆ¶é …
    function updateDistanceTypeUI(type) {
        const pixelContainer = document.getElementById('pixel-distance-container');
        const viewHeightContainer = document.getElementById('viewheight-distance-container');
        const customContainer = document.getElementById('custom-distance-container');

        if (!pixelContainer || !viewHeightContainer || !customContainer) return;

        // éš±è—æ‰€æœ‰å®¹å™¨
        pixelContainer.style.display = 'none';
        viewHeightContainer.style.display = 'none';
        customContainer.style.display = 'none';

        // é¡¯ç¤ºå°æ‡‰é¡å‹çš„å®¹å™¨
        switch (type) {
            case 'pixel':
                pixelContainer.style.display = 'block';
                break;
            case 'viewHeight':
                viewHeightContainer.style.display = 'block';
                break;
            case 'custom':
                customContainer.style.display = 'block';
                break;
        }
    }

    // åˆ‡æ›markersé¡¯ç¤ºç‹€æ…‹çš„å‡½æ•¸
    function toggleMarkers() {
        SHOW_MARKERS = !SHOW_MARKERS;
        localStorage.setItem(MARKERS_STORAGE_KEY, SHOW_MARKERS);

        // æ›´æ–°æ‰€æœ‰ ScrollTrigger çš„ markers ç‹€æ…‹
        ScrollTrigger.getAll().forEach(trigger => {
            trigger.vars.markers = SHOW_MARKERS;
            // å¼·åˆ¶æ›´æ–° ScrollTrigger å¯¦ä¾‹
            trigger.refresh();
        });
    }

    // åˆ‡æ›åœ–ç‰‡ç®¡ç†å™¨é¡¯ç¤ºç‹€æ…‹
    function toggleImageManager() {
        // é€™å€‹å‡½æ•¸ç¾åœ¨åªä¿ç•™ï¼Œä½†å¯¦éš›ä¸Šä¸æœƒè¢«èª¿ç”¨
        console.log('toggleImageManager å‡½æ•¸å·²æ£„ç”¨');
    }

    // æ·»åŠ æ–°åœ–ç‰‡
    function addImage() {
        const newImageConfig = {
            id: imageIdCounter++,
            name: `åœ–ç‰‡ ${imageIdCounter - 1}`,
            url: "",
            fromParams: `{}`,
            toParams: `{}`,
            zIndex: 1  // è¨­ç½®é»˜èªz-indexå€¼
        };

        IMAGES_CONFIG.push(newImageConfig);
        saveImagesConfig();
        renderImageItems();
        updateAnimations();
    }

    // åˆ é™¤å›¾ç‰‡
    function deleteImage(id) {
        // å…ˆæ‰¾åˆ°è¦åˆªé™¤çš„åœ–ç‰‡é…ç½®
        const imageToDelete = IMAGES_CONFIG.find(img => img.id === id);
        if (!imageToDelete) return;

        // å¾DOMä¸­ç§»é™¤åœ–ç‰‡å…ƒç´ 
        const imgElement = document.getElementById(`gsap-trigger-${id}`);
        if (imgElement) {
            imgElement.remove();
        }

        // å¾é…ç½®ä¸­ç§»é™¤åœ–ç‰‡
        IMAGES_CONFIG = IMAGES_CONFIG.filter(img => img.id !== id);
        saveImagesConfig();

        // é‡æ–°æ¸²æŸ“åœ–ç‰‡åˆ—è¡¨
        renderImageItems();

        // é‡æ–°å‰µå»ºå‹•ç•«
        updateAnimations();
    }

    // æ›´æ–°åœ–ç‰‡URL
    function updateImageUrl(id, url) {
        console.log('æ›´æ–°å‰æ™¯åœ–ç‰‡URL:', id, url);
        const image = IMAGES_CONFIG.find(img => img.id === id);
        if (image) {
            image.url = url;
            saveImagesConfig();

            // ç›´æ¥æ›´æ–°DOMä¸­çš„åœ–ç‰‡å…ƒç´ 
            const imgElement = document.getElementById(`gsap-trigger-${id}`);
            if (imgElement) {
                const { src, srcset } = generateSrcSet(url);
                imgElement.src = src;

                if (srcset) {
                    imgElement.srcset = srcset;
                    imgElement.sizes = "(max-width: 800px) 800px, (max-width: 1200px) 1200px, 2000px";
                }
            } else {
                // å¦‚æœæ‰¾ä¸åˆ°åœ–ç‰‡å…ƒç´ ï¼Œå¯èƒ½éœ€è¦é‡æ–°è¼‰å…¥æ‰€æœ‰åœ–ç‰‡
                loadAllImages();
            }

            // é‡æ–°å‰µå»ºå‹•ç•«
            updateAnimations();
        }
    }

    // æ›´æ–°åœ–ç‰‡åç¨±
    function updateImageName(id, name) {
        const image = IMAGES_CONFIG.find(img => img.id === id);
        if (image) {
            image.name = name;
            saveImagesConfig();
            renderImageItems();
        }
    }

    // æ›´æ–°åœ–ç‰‡Fromåƒæ•¸
    function updateImageFromParams(id, params) {
        const image = IMAGES_CONFIG.find(img => img.id === id);
        if (image) {
            image.fromParams = params;
            saveImagesConfig();
            updateAnimations();
        }
    }

    // æ›´æ–°åœ–ç‰‡Toåƒæ•¸
    function updateImageToParams(id, params) {
        const image = IMAGES_CONFIG.find(img => img.id === id);
        if (image) {
            image.toParams = params;
            saveImagesConfig();
            updateAnimations();
        }
    }

    // æ›´æ–°åœ–ç‰‡z-index
    function updateImageZIndex(id, increment) {
        const image = IMAGES_CONFIG.find(img => img.id === id);
        if (image) {
            // ç¢ºä¿ç•¶å‰çš„zIndexæ˜¯æ•¸å­—ï¼Œå¦‚æœä¸æ˜¯å‰‡è¨­ç‚º1
            if (typeof image.zIndex !== 'number' || isNaN(image.zIndex)) {
                image.zIndex = 1;
            }

            // è¨ˆç®—æ–°çš„z-indexå€¼
            image.zIndex = Math.max(1, image.zIndex + increment);

            saveImagesConfig();

            // æ›´æ–°DOMå…ƒç´ çš„z-index
            if (image.isBackground) {
                const bgElement = document.querySelector('.parallax_img-wrapper .is-bg');
                if (bgElement) {
                    bgElement.style.zIndex = image.zIndex;
                }
            } else {
                const imgElement = document.getElementById(`gsap-trigger-${id}`);
                if (imgElement) {
                    imgElement.style.zIndex = image.zIndex;
                }
            }

            renderImageItems();
        }
    }

    // æ¸²æŸ“åœ–ç‰‡é …ç›®åˆ—è¡¨
    function renderImageItems() {
        imageList.innerHTML = '';

        IMAGES_CONFIG.forEach(image => {
            const imageItem = document.createElement('div');
            imageItem.className = 'image-item';
            imageItem.dataset.id = image.id;

            const imageItemHeader = document.createElement('div');
            imageItemHeader.className = 'image-item__header';

            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.value = image.name;
            nameInput.className = 'image-item__name';
            // å¦‚æœæ˜¯èƒŒæ™¯åœ–ï¼Œç¦ç”¨åç¨±ä¿®æ”¹
            if (image.isBackground) {
                nameInput.readOnly = true;
                nameInput.style.opacity = "0.7";
            } else {
                nameInput.addEventListener('change', (e) => updateImageName(image.id, e.target.value));
            }

            imageItemHeader.appendChild(nameInput);

            // æ·»åŠ z-indexæ§åˆ¶å™¨
            const zIndexControl = document.createElement('div');
            zIndexControl.className = 'image-item__z-index';

            const decreaseButton = document.createElement('button');
            decreaseButton.className = 'btn btn--small';
            decreaseButton.textContent = '-';
            decreaseButton.addEventListener('click', () => updateImageZIndex(image.id, -1));

            const zIndexValue = document.createElement('span');
            zIndexValue.className = 'image-item__z-index-value';
            // ç¢ºä¿é¡¯ç¤ºçš„z-indexå€¼æ˜¯æœ‰æ•ˆçš„æ•¸å­—
            zIndexValue.textContent = typeof image.zIndex === 'number' ? image.zIndex : 1;

            const increaseButton = document.createElement('button');
            increaseButton.className = 'btn btn--small';
            increaseButton.textContent = '+';
            increaseButton.addEventListener('click', () => updateImageZIndex(image.id, 1));

            zIndexControl.appendChild(decreaseButton);
            zIndexControl.appendChild(zIndexValue);
            zIndexControl.appendChild(increaseButton);

            imageItemHeader.appendChild(zIndexControl);

            // åªç‚ºéèƒŒæ™¯åœ–æ·»åŠ åˆªé™¤æŒ‰éˆ•
            if (!image.isBackground) {
                const deleteButton = document.createElement('button');
                deleteButton.className = 'btn btn--danger';
                deleteButton.textContent = 'åˆªé™¤';
                deleteButton.style.fontSize = '12px';
                deleteButton.style.padding = '3px 6px';
                deleteButton.addEventListener('click', () => deleteImage(image.id));
                imageItemHeader.appendChild(deleteButton);
            }

            const urlInput = document.createElement('input');
            urlInput.type = 'text';
            urlInput.className = 'image-item__url';
            urlInput.placeholder = 'è«‹è¼¸å…¥åœ–ç‰‡URL';
            urlInput.value = image.url;

            // ç‚ºæ‰€æœ‰åœ–ç‰‡æ·»åŠ URLä¿®æ”¹åŠŸèƒ½
            if (image.isBackground) {
                urlInput.addEventListener('change', (e) => updateBackgroundImageUrl(e.target.value));
            } else {
                urlInput.addEventListener('change', (e) => updateImageUrl(image.id, e.target.value));
            }

            imageItem.appendChild(imageItemHeader);
            imageItem.appendChild(urlInput);

            // åªç‚ºéèƒŒæ™¯åœ–æ·»åŠ å‹•ç•«åƒæ•¸é…ç½®
            if (!image.isBackground) {
                // Fromåƒæ•¸æŠ˜ç–Šé¢æ¿
                const fromHeader = document.createElement('div');
                fromHeader.className = 'accordion__header';
                fromHeader.textContent = 'Fromå‹•ç•«åƒæ•¸';
                fromHeader.addEventListener('click', toggleAccordion);

                const fromContent = document.createElement('div');
                fromContent.className = 'accordion__content';

                const fromTextarea = document.createElement('textarea');
                fromTextarea.className = 'code-editor';
                fromTextarea.value = image.fromParams;
                fromTextarea.addEventListener('change', (e) => updateImageFromParams(image.id, e.target.value));

                fromContent.appendChild(fromTextarea);

                // Toåƒæ•¸æŠ˜ç–Šé¢æ¿
                const toHeader = document.createElement('div');
                toHeader.className = 'accordion__header';
                toHeader.textContent = 'Toå‹•ç•«åƒæ•¸';
                toHeader.addEventListener('click', toggleAccordion);

                const toContent = document.createElement('div');
                toContent.className = 'accordion__content';

                const toTextarea = document.createElement('textarea');
                toTextarea.className = 'code-editor';
                toTextarea.value = image.toParams;
                toTextarea.addEventListener('change', (e) => updateImageToParams(image.id, e.target.value));

                toContent.appendChild(toTextarea);

                imageItem.appendChild(fromHeader);
                imageItem.appendChild(fromContent);
                imageItem.appendChild(toHeader);
                imageItem.appendChild(toContent);
            }

            imageList.appendChild(imageItem);
        });
    }

    // åˆ‡æ›æŠ˜ç–Šé¢æ¿
    function toggleAccordion(e) {
        const content = e.target.nextElementSibling;
        content.style.display = content.style.display === 'block' ? 'none' : 'block';
    }

    // é‡ç½®è¨­å®šç‚ºé»˜èªå€¼
    resetButton.addEventListener('click', function () {
        localStorage.removeItem(STORAGE_KEY);
        Object.assign(SCROLL_CONFIG, getDefaultConfig());
        initializeSliders();
        updateAnimations();
        console.log('è¨­å®šå·²é‡ç½®ç‚ºé»˜èªå€¼');
    });

    // é‡ç½®åœ–ç‰‡è¨­å®šç‚ºé»˜èªå€¼
    function resetImages() {
        if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰åœ–ç‰‡è¨­å®šå—ï¼Ÿæ­¤æ“ä½œå°‡åˆªé™¤æ‚¨æ‰€æœ‰çš„è‡ªå®šç¾©åœ–ç‰‡è¨­å®šã€‚')) {
            localStorage.removeItem(IMAGES_STORAGE_KEY);
            IMAGES_CONFIG = getDefaultImagesConfig();
            imageIdCounter = getNextImageId();
            renderImageItems();
            updateAnimations();
            console.log('åœ–ç‰‡è¨­å®šå·²é‡ç½®ç‚ºé»˜èªå€¼');
        }
    }

    // è¨­ç½®æ»‘å¡Šå€¼è®ŠåŒ–ç›£è½å™¨
    function setupSliderListeners() {
        // ç¾æœ‰çš„æ»‘å¡Šç›£è½å™¨ä¿æŒä¸è®Š
        startSlider.addEventListener('input', event => {
            SCROLL_CONFIG.startViewportPosition = event.target.value / 100;
            updateSliderLabels();
            saveScrollConfig();
            updateAnimations();
        });

        triggerStartSlider.addEventListener('input', event => {
            SCROLL_CONFIG.triggerStartPosition = event.target.value / 100;
            updateSliderLabels();
            saveScrollConfig();
            updateAnimations();
        });

        scrollDistanceSlider.addEventListener('input', event => {
            SCROLL_CONFIG.scrollDistance = parseInt(event.target.value);
            updateSliderLabels();
            saveScrollConfig();
            updateAnimations();
        });

        // æ–°å¢ï¼šæ»¾å‹•è·é›¢é¡å‹é¸æ“‡å™¨
        const distanceTypeSelect = document.getElementById('scroll-distance-type');
        const pixelContainer = document.getElementById('pixel-distance-container');
        const viewHeightContainer = document.getElementById('viewheight-distance-container');
        const customContainer = document.getElementById('custom-distance-container');
        const viewHeightSlider = document.getElementById('scroll-viewheight-slider');
        const viewHeightValue = document.getElementById('scroll-viewheight-value');
        const customCodeInput = document.getElementById('scroll-custom-code');

        // è¨­ç½®åˆå§‹å€¼
        distanceTypeSelect.value = SCROLL_CONFIG.scrollDistanceType;
        viewHeightSlider.value = SCROLL_CONFIG.scrollViewHeightValue;
        viewHeightValue.textContent = SCROLL_CONFIG.scrollViewHeightValue;
        customCodeInput.value = SCROLL_CONFIG.scrollDistanceCustom;

        // æ ¹æ“šç•¶å‰é¡å‹é¡¯ç¤ºç›¸æ‡‰çš„æ§åˆ¶é …
        updateDistanceTypeUI(SCROLL_CONFIG.scrollDistanceType);

        // ç›£è½é¡å‹è®Šæ›´
        distanceTypeSelect.addEventListener('change', (e) => {
            const newType = e.target.value;
            SCROLL_CONFIG.scrollDistanceType = newType;
            updateDistanceTypeUI(newType);
            saveScrollConfig();
            updateAnimations();
        });

        // è¦–çª—é«˜åº¦ç™¾åˆ†æ¯”æ»‘å¡Š
        viewHeightSlider.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            SCROLL_CONFIG.scrollViewHeightValue = value;
            viewHeightValue.textContent = value;
            saveScrollConfig();
            updateAnimations();
        });

        // è‡ªå®šç¾©å‡½æ•¸è¼¸å…¥æ¡†
        customCodeInput.addEventListener('change', (e) => {
            SCROLL_CONFIG.scrollDistanceCustom = e.target.value;
            saveScrollConfig();
            updateAnimations();
        });

        // markers åˆ‡æ›æŒ‰éˆ•
        document.getElementById('markers-toggle').addEventListener('change', function () {
            toggleMarkers();
            updateAnimations();
        });

        // é‡ç½®æŒ‰éˆ•
        resetButton.addEventListener('click', () => {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰æ»¾å‹•è¨­å®šå—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ã€‚')) {
                SCROLL_CONFIG = getDefaultConfig();
                saveScrollConfig();
                initializeSliders();

                // æ›´æ–°è·é›¢é¡å‹UI
                distanceTypeSelect.value = SCROLL_CONFIG.scrollDistanceType;
                viewHeightSlider.value = SCROLL_CONFIG.scrollViewHeightValue;
                viewHeightValue.textContent = SCROLL_CONFIG.scrollViewHeightValue;
                customCodeInput.value = SCROLL_CONFIG.scrollDistanceCustom;
                updateDistanceTypeUI(SCROLL_CONFIG.scrollDistanceType);

                updateAnimations();
            }
        });

        // æ–°å¢åœ–ç‰‡æŒ‰éˆ•
        addImageButton.addEventListener('click', addImage);

        // é‡ç½®åœ–ç‰‡æŒ‰éˆ•
        resetImagesButton.addEventListener('click', () => {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰åœ–ç‰‡è¨­å®šå—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ã€‚')) {
                IMAGES_CONFIG = getDefaultImagesConfig();
                saveImagesConfig();
                renderImageItems();
                loadAllImages();
                updateAnimations();
            }
        });

        // å°å‡ºé…ç½®æŒ‰éˆ•
        exportConfigButton.addEventListener('click', exportConfig);
    }

    // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹åº
    function init() {
        console.log('åˆå§‹åŒ–é–‹å§‹');
        console.log('markersé¡¯ç¤ºç‹€æ…‹:', SHOW_MARKERS);

        // ç¢ºä¿æ‰€æœ‰åœ–ç‰‡éƒ½æœ‰æœ‰æ•ˆçš„z-indexå€¼
        IMAGES_CONFIG.forEach(image => {
            if (typeof image.zIndex !== 'number' || isNaN(image.zIndex)) {
                image.zIndex = 1;
            }
        });
        saveImagesConfig();

        // åˆå§‹åŒ–æ»‘å¡Š
        initializeSliders();

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        setupSliderListeners();

        // æ¸²æŸ“åœ–ç‰‡é …ç›®åˆ—è¡¨
        renderImageItems();

        // å¼·åˆ¶æ¸…é™¤å’Œé‡æ–°åŠ è¼‰æ‰€æœ‰åœ–ç‰‡
        loadAllImages();

        // æ›´æ–°å‹•ç•«
        updateAnimations();

        console.log('åˆå§‹åŒ–å®Œæˆ: markersé¡¯ç¤ºç‹€æ…‹=', SHOW_MARKERS);
    }

    // è¼‰å…¥æ‰€æœ‰åœ–ç‰‡çš„è¼”åŠ©å‡½æ•¸
    function loadAllImages() {
        try {
            const parallaxWrapper = document.querySelector(".parallax_img-wrapper");
            if (!parallaxWrapper) {
                console.error('æ‰¾ä¸åˆ°åœ–ç‰‡å®¹å™¨å…ƒç´ !');
                return;
            }

            // 1. æª¢æŸ¥ä¸¦ç²å–èƒŒæ™¯åœ–å…ƒç´ 
            let bgImageElement = parallaxWrapper.querySelector(".is-bg");

            // æ‰¾åˆ°é…ç½®ä¸­çš„èƒŒæ™¯åœ–
            const bgImageConfig = IMAGES_CONFIG.find(img => img.isBackground);

            // å¦‚æœæ‰¾åˆ°èƒŒæ™¯åœ–é…ç½®ä½†DOMä¸­æ²’æœ‰èƒŒæ™¯åœ–å…ƒç´ ï¼Œå‰µå»ºä¸€å€‹
            if (bgImageConfig && !bgImageElement) {
                bgImageElement = document.createElement("img");
                bgImageElement.className = "is-bg";
                bgImageElement.alt = bgImageConfig.name;
                parallaxWrapper.appendChild(bgImageElement);
            }

            // æ›´æ–°èƒŒæ™¯åœ–URLå’Œz-index
            if (bgImageElement && bgImageConfig) {
                const { src, srcset } = generateSrcSet(bgImageConfig.url);
                bgImageElement.src = src;

                if (srcset) {
                    bgImageElement.srcset = srcset;
                    bgImageElement.sizes = "(max-width: 800px) 800px, (max-width: 1200px) 1200px, 2000px";
                }

                bgImageElement.style.zIndex = bgImageConfig.zIndex;
            }

            // 2. æ¸…é™¤æ‰€æœ‰ç¾æœ‰å‰æ™¯åœ–ç‰‡ï¼ˆä¿ç•™èƒŒæ™¯åœ–ï¼‰
            Array.from(parallaxWrapper.querySelectorAll(".is-abs, .parallax__img--absolute")).forEach(img => {
                if (!img.classList.contains('is-bg')) {
                    img.remove();
                }
            });

            // 3. æª¢æŸ¥æ˜¯å¦æœ‰åœ–ç‰‡é…ç½®
            if (IMAGES_CONFIG.filter(img => !img.isBackground).length === 0) {
                console.warn('æ²’æœ‰å‰æ™¯åœ–ç‰‡é…ç½®ï¼ŒåŠ è¼‰é»˜èªåœ–ç‰‡');
                // ä¿ç•™èƒŒæ™¯åœ–é…ç½®ï¼Œæ·»åŠ é»˜èªå‰æ™¯åœ–
                if (bgImageConfig) {
                    const defaultImages = getDefaultImagesConfig().filter(img => !img.isBackground);
                    IMAGES_CONFIG = [bgImageConfig, ...defaultImages];
                } else {
                    IMAGES_CONFIG = getDefaultImagesConfig();
                }
                saveImagesConfig();
            }

            // 4. å‰µå»ºæ‰€æœ‰å‰æ™¯åœ–ç‰‡å…ƒç´ 
            IMAGES_CONFIG.forEach((config, index) => {
                // è·³éèƒŒæ™¯åœ–å’Œç„¡URLçš„åœ–ç‰‡
                if (config.isBackground || !config.url) {
                    return;
                }

                console.log(`æ·»åŠ å‰æ™¯åœ–ç‰‡ #${index}: ${config.name}`);

                const { src, srcset } = generateSrcSet(config.url);

                const img = document.createElement("img");
                img.className = "is-abs parallax__img--absolute";
                img.id = `gsap-trigger-${config.id}`;
                img.src = src;

                if (srcset) {
                    img.srcset = srcset;
                    img.sizes = "(max-width: 800px) 800px, (max-width: 1200px) 1200px, 2000px";
                }

                img.alt = config.name;
                img.style.zIndex = config.zIndex;
                parallaxWrapper.appendChild(img);
            });

            console.log(`æˆåŠŸåŠ è¼‰ ${IMAGES_CONFIG.length} å¼µåœ–ç‰‡ï¼ˆåŒ…å«èƒŒæ™¯åœ–ï¼‰`);
        } catch (error) {
            console.error('åŠ è¼‰åœ–ç‰‡æ™‚å‡ºéŒ¯:', error);
        }
    }

    // æ›´æ–°æ‰€æœ‰å‹•ç•«çš„å‡½æ•¸
    function updateAnimations() {
        console.log('é–‹å§‹æ›´æ–°å‹•ç•«, markersé¡¯ç¤ºç‹€æ…‹:', SHOW_MARKERS);

        // æ¸…é™¤ç¾æœ‰çš„ScrollTriggerå¯¦ä¾‹
        ScrollTrigger.getAll().forEach(trigger => trigger.kill());

        // ç²å–è¨­ç½®åƒæ•¸
        const viewportStart = `${Math.round(SCROLL_CONFIG.startViewportPosition * 100)}%`;
        const triggerStart = `${Math.round(SCROLL_CONFIG.triggerStartPosition * 100)}%`;
        const scrollDistance = SCROLL_CONFIG.scrollDistance;

        // è¨­ç½®èµ·å§‹ä½ç½®
        const startPos = `${triggerStart} ${viewportStart}`;

        // æ ¹æ“šæ»¾å‹•è·é›¢é¡å‹è¨­ç½®ä¸åŒçš„çµæŸä½ç½®
        let endPos;

        switch (SCROLL_CONFIG.scrollDistanceType) {
            case 'pixel':
                endPos = `+=${scrollDistance}`;
                break;
            case 'viewHeight':
                // ä½¿ç”¨è¦–çª—é«˜åº¦çš„ç™¾åˆ†æ¯”
                const viewHeightValue = SCROLL_CONFIG.scrollViewHeightValue / 100;
                endPos = `+=${window.innerHeight * viewHeightValue}`;
                break;
            case 'custom':
                try {
                    // åŸ·è¡Œè‡ªå®šç¾©å‡½æ•¸
                    const customFunction = new Function('return ' + SCROLL_CONFIG.scrollDistanceCustom)();
                    endPos = customFunction();
                } catch (error) {
                    console.error('è‡ªå®šç¾©æ»¾å‹•è·é›¢å‡½æ•¸éŒ¯èª¤:', error);
                    // ç™¼ç”ŸéŒ¯èª¤æ™‚ä½¿ç”¨é»˜èªå€¼
                    endPos = `+=500`;
                }
                break;
            default:
                endPos = `+=${scrollDistance}`;
        }

        // è¨˜éŒ„é…ç½®ä¿¡æ¯
        console.log('å‹•ç•«è¨­å®šï¼š', {
            èµ·å§‹ä½ç½®: startPos,
            çµæŸä½ç½®: endPos,
            æ»¾å‹•è·é›¢é¡å‹: SCROLL_CONFIG.scrollDistanceType,
            è¦–çª—é«˜åº¦: `${window.innerHeight}px`,
            markersé¡¯ç¤º: SHOW_MARKERS
        });

        // é‡ç½®é€²åº¦ä¿¡æ¯
        progressValue.textContent = '0%';

        // å‰µå»ºä¸»ScrollTriggerå¯¦ä¾‹
        const st = ScrollTrigger.create({
            trigger: ".parallax_wrapper",
            start: startPos,
            end: endPos,
            markers: SHOW_MARKERS,
            scrub: 1,
            onUpdate: self => {
                progressValue.textContent = `${Math.round(self.progress * 100)}%`;
            }
        });

        // å®šç¾©å…±ç”¨çš„ScrollTriggeré…ç½®
        const commonScrollTriggerConfig = {
            trigger: ".parallax_wrapper",
            start: startPos,
            end: endPos,
            markers: SHOW_MARKERS,
            scrub: 1
        };

        // å–å¾—æ‰€æœ‰ç•¶å‰åœ–ç‰‡å…ƒç´ 
        const parallaxWrapper = document.querySelector(".parallax_img-wrapper");
        if (!parallaxWrapper) {
            console.error('æ‰¾ä¸åˆ°åœ–ç‰‡å®¹å™¨å…ƒç´ !');
            return;
        }

        // ç‚ºæ‰€æœ‰ç¾æœ‰åœ–ç‰‡å‰µå»ºå‹•ç•«
        IMAGES_CONFIG.forEach((imageConfig, index) => {
            if (!imageConfig.url || imageConfig.isBackground) {
                return;  // è·³éæ²’æœ‰URLçš„åœ–ç‰‡å’ŒèƒŒæ™¯åœ–
            }

            try {
                // å–å¾—å°æ‡‰çš„åœ–ç‰‡å…ƒç´ 
                const imgElement = document.getElementById(`gsap-trigger-${imageConfig.id}`);

                if (!imgElement) {
                    console.log(`æ‰¾ä¸åˆ°åœ–ç‰‡å…ƒç´  #gsap-trigger-${imageConfig.id}ï¼Œè·³éå‹•ç•«å‰µå»º`);
                    return;
                }

                // æª¢æŸ¥æ˜¯å¦æœ‰å‹•ç•«åƒæ•¸
                if (!imageConfig.fromParams || !imageConfig.toParams ||
                    imageConfig.fromParams.trim() === '{}' || imageConfig.toParams.trim() === '{}') {
                    console.log(`åœ–ç‰‡ ${imageConfig.name} æ²’æœ‰è¨­ç½®å‹•ç•«åƒæ•¸æˆ–åƒæ•¸ç‚ºç©ºï¼Œè·³éå‹•ç•«å‰µå»º`);
                    return;  // å¦‚æœæ²’æœ‰è¨­ç½®åƒæ•¸æˆ–åƒæ•¸ç‚ºç©ºå°è±¡ï¼Œä¸å‰µå»ºå‹•ç•«
                }

                // å˜—è©¦è§£æå‹•ç•«åƒæ•¸
                let fromParams, toParams;
                try {
                    fromParams = eval(`(${imageConfig.fromParams})`);
                    // æª¢æŸ¥æ˜¯å¦ç‚ºç©ºå°è±¡
                    if (Object.keys(fromParams).length === 0) {
                        console.log(`åœ–ç‰‡ ${imageConfig.name} çš„Fromåƒæ•¸ç‚ºç©ºå°è±¡ï¼Œè·³éå‹•ç•«å‰µå»º`);
                        return;
                    }
                } catch (e) {
                    console.error(`è§£æFromåƒæ•¸å¤±æ•— (${imageConfig.name}):`, e);
                    return;  // è§£æå¤±æ•—æ™‚ä¸å‰µå»ºå‹•ç•«ï¼Œè€Œä¸æ˜¯è¨­ç½®é»˜èªå€¼
                }

                try {
                    toParams = eval(`(${imageConfig.toParams})`);
                    // æª¢æŸ¥æ˜¯å¦ç‚ºç©ºå°è±¡
                    if (Object.keys(toParams).length === 0) {
                        console.log(`åœ–ç‰‡ ${imageConfig.name} çš„Toåƒæ•¸ç‚ºç©ºå°è±¡ï¼Œè·³éå‹•ç•«å‰µå»º`);
                        return;
                    }
                } catch (e) {
                    console.error(`è§£æToåƒæ•¸å¤±æ•— (${imageConfig.name}):`, e);
                    return;  // è§£æå¤±æ•—æ™‚ä¸å‰µå»ºå‹•ç•«ï¼Œè€Œä¸æ˜¯è¨­ç½®é»˜èªå€¼
                }

                // å‰µå»ºGSAPå‹•ç•«
                gsap.fromTo(
                    `#gsap-trigger-${imageConfig.id}`,
                    fromParams,
                    {
                        ...toParams,
                        scrollTrigger: commonScrollTriggerConfig,
                    }
                );

                console.log(`å·²å‰µå»ºåœ–ç‰‡å‹•ç•«: ${imageConfig.name}`, { from: fromParams, to: toParams });
            } catch (error) {
                console.error(`å‰µå»ºåœ–ç‰‡å‹•ç•«å¤±æ•— (${imageConfig.name}):`, error);
            }
        });
    }

    // æ›´æ–°èƒŒæ™¯åœ–URLçš„å°ˆç”¨å‡½æ•¸
    function updateBackgroundImageUrl(url) {
        // æ›´æ–°é…ç½®ä¸­çš„èƒŒæ™¯åœ–URL
        const bgImage = IMAGES_CONFIG.find(img => img.isBackground);
        if (bgImage) {
            bgImage.url = url;
            saveImagesConfig();
        }

        // æ›´æ–°DOMä¸­çš„èƒŒæ™¯åœ–
        const bgImageElement = document.querySelector(".parallax_img-wrapper .is-bg");
        if (bgImageElement) {
            const { src, srcset } = generateSrcSet(url);
            bgImageElement.src = src;

            if (srcset) {
                bgImageElement.srcset = srcset;
                bgImageElement.sizes = "(max-width: 800px) 800px, (max-width: 1200px) 1200px, 2000px";
            }
        }

        console.log('èƒŒæ™¯åœ–URLå·²æ›´æ–°:', url);
    }

    // å°å‡ºé…ç½®å‡½æ•¸
    function exportConfig() {
        // ç”Ÿæˆå”¯ä¸€æ¨¡çµ„IDï¼Œç”¨æ–¼é¿å…å¤šå€‹æ¨¡çµ„è¡çª
        const moduleId = 'parallax_' + Math.random().toString(36).substring(2, 10);

        const config = {
            moduleId: moduleId, // æ·»åŠ å”¯ä¸€æ¨¡çµ„ID
            scrollConfig: SCROLL_CONFIG,
            imagesConfig: IMAGES_CONFIG.map(img => ({
                ...img,
                // é‡æ–°æ˜ å°„IDï¼Œç¢ºä¿ä¸åŒæ¨¡çµ„çš„åœ–ç‰‡IDä¸è¡çª
                uniqueId: `${moduleId}_img_${img.id}`
            })),
            version: "1.0"
        };

        // å‰µå»ºå®Œæ•´çš„é…ç½®å­—ç¬¦ä¸²ï¼ŒåŒ…å« const config = å®£å‘Šéƒ¨åˆ†
        const configString = `const config = ${JSON.stringify(config, null, 2)};`;

        // å‰µå»ºä¸€å€‹è‡¨æ™‚å…ƒç´ ç”¨æ–¼è¤‡è£½åˆ°å‰ªè²¼æ¿
        const textarea = document.createElement('textarea');
        textarea.value = configString;
        document.body.appendChild(textarea);
        textarea.select();

        try {
            // å˜—è©¦è¤‡è£½åˆ°å‰ªè²¼æ¿
            document.execCommand('copy');

            // é¡¯ç¤ºå°è©±æ¡†
            const dialog = document.getElementById('export-dialog');
            const closeButton = dialog.querySelector('.export-dialog__close-button');
            const downloadButton = dialog.querySelector('.export-dialog__download-button');

            dialog.style.display = 'block';

            // ç‚ºä¸‹è¼‰æŒ‰éˆ•æ·»åŠ äº‹ä»¶
            downloadButton.addEventListener('click', function () {
                const blob = new Blob([configString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'parallax_config.json';
                a.click();
                URL.revokeObjectURL(url);
            });

            // ç‚ºé—œé–‰æŒ‰éˆ•æ·»åŠ äº‹ä»¶
            closeButton.addEventListener('click', function () {
                dialog.style.display = 'none';
            });
        } catch (err) {
            console.error('è¤‡è£½åˆ°å‰ªè²¼æ¿å¤±æ•—:', err);
            alert('è¤‡è£½åˆ°å‰ªè²¼æ¿å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
        } finally {
            // ç§»é™¤è‡¨æ™‚å…ƒç´ 
            document.body.removeChild(textarea);
        }
    }

    // æ·»åŠ é¢æ¿åˆ‡æ›åŠŸèƒ½
    toggleButton.addEventListener('click', function () {
        controlPanel.classList.toggle('hidden');
        toggleButton.classList.toggle('hidden');
    });

    // æ·»åŠ è¦–çª—å°ºå¯¸è®ŠåŒ–ç›£è½å™¨ï¼Œç•¶è¦–çª—å¤§å°æ”¹è®Šæ™‚é‡æ–°è¼‰å…¥é©åˆçš„åœ–ç‰‡
    window.addEventListener('resize', debounce(function () {
        loadAllImages();
    }, 250));

    // å¢åŠ é˜²æŠ–å‹•å‡½æ•¸é¿å…é »ç¹è§¸ç™¼resizeäº‹ä»¶
    function debounce(func, wait) {
        let timeout;
        return function () {
            const context = this;
            const args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(function () {
                func.apply(context, args);
            }, wait);
        };
    }

    // å•Ÿå‹•æ‡‰ç”¨ç¨‹åº
    init();
</script>